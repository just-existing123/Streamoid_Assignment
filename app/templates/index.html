<!DOCTYPE html>
<html>
<head>
    <title>Product Catalog Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { padding-top: 2rem; }
        .search-box { margin: 2rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px; }
        .results-box { margin-top: 2rem; }
        .upload-box { padding: 2rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 2rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Product Catalog Manager</h1>
        
        <!-- Upload Section -->
        <div class="upload-box">
            <h3>Upload Products CSV</h3>
            <form action="/upload" method="post" enctype="multipart/form-data" class="mb-3">
                <div class="mb-3">
                    <input type="file" class="form-control" name="file" accept=".csv" required>
                </div>
                <button type="submit" class="btn btn-primary">Upload CSV</button>
            </form>
            {% if message %}
            <div class="alert alert-{{ message_type }}">
                {{ message }}
            </div>
            {% endif %}
        </div>

        <!-- Search Section -->
        <div class="search-box">
            <h3>Search Products</h3>
            <form id="searchForm" method="get" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">SKU</label>
                    <input type="text" class="form-control" name="sku" value="{{ search_params.sku }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Brand</label>
                    <input type="text" class="form-control" name="brand" value="{{ search_params.brand }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Color</label>
                    <input type="text" class="form-control" name="color" value="{{ search_params.color }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Size</label>
                    <input type="text" class="form-control" name="size" value="{{ search_params.size }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Min Price</label>
                    <input type="number" step="0.01" class="form-control" name="min_price" value="{{ search_params.min_price }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Max Price</label>
                    <input type="number" step="0.01" class="form-control" name="max_price" value="{{ search_params.max_price }}">
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a href="/" class="btn btn-secondary">Clear</a>
                </div>
            </form>
            
            <script>
                document.getElementById('searchForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const formData = new FormData(form);
                    const searchParams = new URLSearchParams();
                    
                    for (let [key, value] of formData.entries()) {
                        if (value.trim() !== '') {
                            searchParams.append(key, value.trim());
                        }
                    }
                    
                    window.location.href = '/?' + searchParams.toString();
                });
            </script>
        </div>

        <!-- Results Section -->
        <div class="results-box mt-4">
            {% if products %}
                <h3>Products ({{ products|length }} results)</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Name</th>
                                <th>Brand</th>
                                <th>Color</th>
                                <th>Size</th>
                                <th>MRP</th>
                                <th>Price</th>
                                <th>Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                            <tr>
                                <td>{{ product.sku }}</td>
                                <td>{{ product.name }}</td>
                                <td>{{ product.brand }}</td>
                                <td>{{ product.color }}</td>
                                <td>{{ product.size }}</td>
                                <td>₹{{ product.mrp }}</td>
                                <td>₹{{ product.price }}</td>
                                <td>{{ product.quantity }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% elif request.query_params %}
                <div class="alert alert-info">
                    No products found matching your search criteria. Try adjusting your filters.
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>